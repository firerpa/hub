var ce=Object.defineProperty;var re=(n,d,s)=>d in n?ce(n,d,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[d]=s;var U=(n,d,s)=>re(n,typeof d!="symbol"?d+"":d,s);import{_ as xe}from"./chunk-a19e325c.js";import{H as ue,c as _e,g as ve,b as X,e as pe,f as he}from"./chunk-4eb5bf64.js";import{n as i,I as me,d as W,L as ee,M as te,i as I,j as ae,D as fe,m as g,c as x,o as a,a as S,k as D,q as N,t as B,N as ye,O as Y,Q as le,h as J,l,A as E,F as q,w as F,f as p,C as ge,B as be,g as H,p as se,e as ie,y as oe,r as ke,E as ne,R as Z,S as we}from"./chunk-afca7c7e.js";import{a as Ie}from"./chunk-1c9c11ae.js";var Ce={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832.6 191.4c-84.6-84.6-221.5-84.6-306 0l-96.9 96.9 51 51 96.9-96.9c53.8-53.8 144.6-59.5 204 0 59.5 59.5 53.8 150.2 0 204l-96.9 96.9 51.1 51.1 96.9-96.9c84.4-84.6 84.4-221.5-.1-306.1zM446.5 781.6c-53.8 53.8-144.6 59.5-204 0-59.5-59.5-53.8-150.2 0-204l96.9-96.9-51.1-51.1-96.9 96.9c-84.6 84.6-84.6 221.5 0 306s221.5 84.6 306 0l96.9-96.9-51-51-96.8 97zM260.3 209.4a8.03 8.03 0 00-11.3 0L209.4 249a8.03 8.03 0 000 11.3l554.4 554.4c3.1 3.1 8.2 3.1 11.3 0l39.6-39.6c3.1-3.1 3.1-8.2 0-11.3L260.3 209.4z"}}]},name:"disconnect",theme:"outlined"};function K(n){for(var d=1;d<arguments.length;d++){var s=arguments[d]!=null?Object(arguments[d]):{},c=Object.keys(s);typeof Object.getOwnPropertySymbols=="function"&&(c=c.concat(Object.getOwnPropertySymbols(s).filter(function(r){return Object.getOwnPropertyDescriptor(s,r).enumerable}))),c.forEach(function(r){ze(n,r,s[r])})}return n}function ze(n,d,s){return d in n?Object.defineProperty(n,d,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[d]=s,n}var G=function(d,s){var c=K({},d,s.attrs);return i(me,K({},c,{icon:Ce}),null)};G.displayName="DisconnectOutlined";G.inheritAttrs=!1;const Oe={key:1,class:"disconnect-text"},Se=["id"],$e={class:"device-info"},je={class:"domain dot"},Te={class:"brand dot"},Le=W({__name:"card",props:{deviceItem:{type:Object,default:null}},setup(n){const d=n,s=ee(te,{style:{fontSize:"32px"},spin:!0}),c=I(d.deviceItem.state!=1),r=I(null);let f=null;const m=I(!1),$=I(d.deviceItem.state!=1);class M{constructor(u){U(this,"player");U(this,"base");U(this,"quality");U(this,"fps");U(this,"scale");U(this,"decoder");U(this,"live");U(this,"canvas");U(this,"image");U(this,"ctx2d");this.init(u)}async init(u){let v=0,h=0;m.value=!0;try{const{data:k,status:j}=await Y({url:u.base.replace(/^ws/,"http")+"ui/stub",data:'{"method":"deviceInfo","params":[]}',method:"POST",timeout:15e3});if(m.value=!1,await le(),j===200){this.image=new Image,this.canvas=document.getElementById(u.nodeId),this.ctx2d=this.canvas.getContext("2d"),v=k.result.displayWidth,h=k.result.displayHeight,!k.result.naturalOrientation&&(v=k.result.displayHeight,h=k.result.displayWidth);const y=r.value.clientWidth,T=r.value.clientHeight,z=y/v<T/h?y/v:T/h;this.canvas.width=v,this.canvas.height=h;const t=Math.floor(v*z),e=Math.floor(h*z);this.canvas.style.width=t+"px",this.canvas.style.height=e+"px",this.base=u.base,this.quality=u.quality||25,this.fps=u.fps||10,this.scale=u.scale||.4,this.live=new WebSocket(this.base+"ws/screen/"+this.fps+"@"+this.quality+"/live?scale="+this.scale+"&type=mjpeg&backend=0"),this.live.binaryType="blob",this.live.onopen=this.onopen.bind(this),this.live.onmessage=this.onmessage.bind(this),this.live.onclose=this.onclose.bind(this),this.live.onerror=this.onerror.bind(this)}else c.value=!0}catch(k){console.log(k),c.value=!0,m.value=!1,$.value=!0}}onerror(u){console.log("onerror",u),c.value=!0,$.value=!0}onclose(u){console.log("onclose",u)}onmessage(u){var v=new Blob([u.data],{type:"image/jpeg"}),h=window.URL||window.webkitURL,k=this;this.image.onload=function(){k.ctx2d.drawImage(k.image,0,0,k.canvas.width,k.canvas.height),k.image.onload=null},this.image.src=h.createObjectURL(v)}onopen(u){Y.post(this.base.replace(/^ws/,"http")+"ui/stub",JSON.stringify({method:"makeToast",params:["FireRPA control connected",0]})).then(v=>{}).catch(v=>{}),console.log("onopen:"+d.deviceItem.domain,u)}close(){this.live&&(this.live.close(),this.live=null)}}const b=async()=>{f=new M({base:location.protocol.replace("http","ws")+"//"+location.host+"/d/"+d.deviceItem.domain+"/",nodeId:"canvas-"+d.deviceItem.domain})};return ae(()=>{!c.value&&b()}),fe(()=>{console.log("onUnmounted:"+d.deviceItem.domain,f),f&&f.close()}),(C,u)=>{const v=g("a-spin");return a(),x("div",{class:ye(["card-content",{mask:c.value}])},[S("div",{ref_key:"canvasBox",ref:r,class:"canvas-outer"},[m.value?(a(),D(v,{key:0,indicator:N(s)},null,8,["indicator"])):$.value?(a(),x("div",Oe,[i(N(G),{style:{fontSize:"52px"}})])):(a(),x("canvas",{key:2,id:"canvas-"+n.deviceItem.domain},null,8,Se))],512),S("div",$e,[S("div",je,B(n.deviceItem.domain),1),S("div",Te,B(n.deviceItem.brand),1)])],2)}}}),Re=J(Le,[["__scopeId","data-v-333461bf"]]),De=n=>(se("data-v-eb8a7c45"),n=n(),ie(),n),Ee=De(()=>S("h4",null,"选择设备",-1)),Me={key:0,class:"comment-cell"},Ue={class:"comment-text"},Pe={key:1,class:"edit-line"},Ae={key:0},Be={key:1},qe={key:2},Ne=W({__name:"selected",props:{deviceList:{type:Array,default:[]}},emits:["select"],setup(n,{emit:d}){var k;const s=(k=Ie.getUser())==null?void 0:k.admin,c=n,r=I(!1),f=I(-1),m=I(""),$=(j,y)=>{f.value=j,m.value=y,r.value=!0},M=d,b=I([]),C=j=>{b.value=j;const y=c.deviceList.filter(T=>j.includes(T.domain));M("select",y)},u=[{title:"设备域名",dataIndex:"domain"},{title:"品牌",dataIndex:"brand"},{title:"型号",dataIndex:"device"},{title:"备注",dataIndex:"comment"},{title:"状态",dataIndex:"state"}],v=async j=>{var y,T;if(j==="save"&&f.value!==-1)try{const z=await _e(c.deviceList[f.value].domain,m.value);((y=z==null?void 0:z.data)==null?void 0:y.status)==0?(c.deviceList[f.value].comment=m.value,H.success("修改成功")):H.error("修改失败："+((T=z==null?void 0:z.data)==null?void 0:T.message))}finally{h()}else j==="cancel"&&h()},h=()=>{f.value=-1,m.value="",r.value=!1};return(j,y)=>{const T=g("a-tooltip"),z=g("a-input"),t=g("a-tag"),e=g("a-table");return a(),D(e,{columns:u,"data-source":n.deviceList,scroll:{y:200},"row-selection":{selectedRowKeys:b.value,onChange:C,getCheckboxProps:_=>({disabled:_.state!==1})},pagination:!1,"row-key":"domain",style:{width:"33vw"}},{title:l(()=>[Ee]),bodyCell:l(({column:_,record:o,index:w,text:O})=>[_.dataIndex==="comment"?(a(),x(q,{key:0},[!r.value||f.value!==w?(a(),x("div",Me,[i(T,{placement:"right"},{title:l(()=>[p(B(O||""),1)]),default:l(()=>[N(s)?(a(),D(N(ue),{key:0,class:"edit-icon",onClick:F(P=>$(w,o.comment),["stop"])},null,8,["onClick"])):E("",!0),S("span",Ue,B(O||""),1)]),_:2},1024)])):(a(),x("div",Pe,[i(z,{value:m.value,onClick:y[0]||(y[0]=F(()=>{},["stop"])),onInput:y[1]||(y[1]=F(P=>m.value=P.target.value,["stop"]))},null,8,["value"]),i(N(ge),{class:"ico",onClick:y[2]||(y[2]=F(P=>v("save"),["stop"]))}),i(N(be),{class:"ico",onClick:y[3]||(y[3]=F(P=>v("cancel"),["stop"]))})]))],64)):E("",!0),_.dataIndex==="state"?(a(),x(q,{key:1},[o.state===1?(a(),x("div",Ae,[i(t,{color:"green"},{default:l(()=>[p("在线")]),_:1})])):o.state===0?(a(),x("div",Be,[i(t,{color:"red"},{default:l(()=>[p("离线")]),_:1})])):(a(),x("div",qe,[i(t,{color:"gray"},{default:l(()=>[p("未知")]),_:1})]))],64)):E("",!0)]),_:1},8,["data-source","row-selection"])}}}),He=J(Ne,[["__scopeId","data-v-eb8a7c45"]]),Ve=S("h2",null,"任务列表",-1),Fe=S("span",{style:{color:"orange"}},"输出",-1),We={key:0},Je={key:0},Qe={key:0},Ge={key:1},Xe={key:1},Ye={key:0},Ze={key:0},Ke={key:1},et={key:2},tt={key:3},at={key:4},lt=W({__name:"tasks",props:{taskList:{type:Array,default:[]}},emits:["delete","refresh"],setup(n,{emit:d}){const s=m=>{r("delete",m)},c=()=>{r("refresh")},r=d,f=[{title:"脚本路径",dataIndex:"script_path"},{title:"开始时间",dataIndex:"start_date"},{title:"结束时间",dataIndex:"end_date"},{title:"流程",dataIndex:"status"},{title:"状态",dataIndex:"result"},{title:"操作",dataIndex:"operating"}];return(m,$)=>{const M=g("a-button"),b=g("a-typography-link"),C=g("a-tag"),u=g("a-table");return a(),D(u,{columns:f,"data-source":n.taskList,scroll:{y:180},pagination:!1,"row-key":"id",style:{width:"33vw"},bordered:""},{title:l(()=>[Ve,i(M,{size:"small",onClick:c},{default:l(()=>[p("刷新")]),_:1}),i(M,{size:"small",danger:"",style:{"margin-left":"10px"},onClick:$[0]||($[0]=v=>s(null))},{default:l(()=>[p("清除")]),_:1})]),expandColumnTitle:l(()=>[Fe]),expandedRowRender:l(({record:v})=>[v.result?(a(),x("p",We,B(v.result.return_code===0?v.result.stdout:v.result.stderr),1)):E("",!0)]),bodyCell:l(({column:v,record:h})=>[v.dataIndex==="operating"?(a(),D(b,{key:0,onClick:k=>s(h.id)},{default:l(()=>[p(B(h.status==="running"?"终止":"删除"),1)]),_:2},1032,["onClick"])):v.dataIndex==="result"?(a(),x(q,{key:1},[h.result?(a(),x("div",Je,[h.result.return_code===0?(a(),x("div",Qe,[i(C,{color:"green"},{default:l(()=>[p("正常")]),_:1})])):(a(),x("div",Ge,[i(C,{color:"red"},{default:l(()=>[p("异常")]),_:1})]))])):h.process_info?(a(),x("div",Xe,[h.process_info.pid?(a(),x("div",Ye,[i(C,{color:"processing"},{default:l(()=>[p("pid: "+B(h.process_info.pid),1)]),_:2},1024)])):E("",!0)])):E("",!0)],64)):E("",!0),v.dataIndex==="status"?(a(),x(q,{key:2},[h.status==="completed"?(a(),x("div",Ze,[i(C,{color:"green"},{default:l(()=>[p("完成")]),_:1})])):h.status==="error"?(a(),x("div",Ke,[i(C,{color:"red"},{default:l(()=>[p("异常")]),_:1})])):h.status==="running"?(a(),x("div",et,[i(C,{color:"orange"},{default:l(()=>[p("运行中")]),_:1})])):h.status==="cancelled"?(a(),x("div",tt,[i(C,{color:"default"},{default:l(()=>[p("已终止")]),_:1})])):(a(),x("div",at,[i(C,{color:"red"},{default:l(()=>[p("超时")]),_:1})]))],64)):E("",!0)]),_:1},8,["data-source"])}}}),de=n=>(se("data-v-7dd249db"),n=n(),ie(),n),st=de(()=>S("h2",null,"待添加好友列表",-1)),it={style:{float:"right"}},ot={class:"auth-content"},nt=de(()=>S("h3",null,"验证语：",-1)),dt={key:0},ct={class:"toolbar"},rt={key:0},xt={key:0},ut={key:1},_t=W({__name:"input",setup(n,{expose:d}){const s=[{title:"微信号",dataIndex:"wx_id"},{title:"验证语",dataIndex:"auth"},{title:"操作",dataIndex:"operation"}],c=I([]),r=I([]),f=I(""),m=I(),$=t=>{r.value=r.value.filter(e=>e!==t)},M=()=>{let t="";if(r.value.length>0){const e=Math.floor(Math.random()*r.value.length);t=r.value[e]}return t};d({data:c});const b=()=>{c.value=[]},C=oe(()=>c.value.length),u=ke({}),v=t=>{u[t]=Z(c.value.filter(e=>t===e.key)[0])},h=t=>{Object.assign(c.value.filter(e=>t===e.key)[0],u[t]),delete u[t]},k=t=>{c.value=c.value.filter(e=>t!==e.key)},j=()=>{let t=M();const e={key:""+(C.value+1),wx_id:"",auth:t};c.value.push(e),u[e.key]=Z(e),le(()=>{var o;const _=(o=m.value)==null?void 0:o.$el;if(_){const w=_.querySelector(".ant-table-body");w&&(w.scrollTop=w.scrollHeight)}})},y=t=>{r.value.push(t),f.value=""},T=t=>new Promise((e,_)=>{const o=new FileReader;o.onload=w=>{var O;e((O=w.target)==null?void 0:O.result)},o.onerror=_,o.readAsText(t,"UTF-8")}),z=async t=>{try{(await T(t)).split(/\r?\n/).filter(o=>o.trim()!=="").forEach((o,w)=>{const O=M();c.value.push({key:""+(C.value+1),wx_id:o.trim(),auth:O})})}catch(e){throw console.error("文件读取失败:",e),new Error("文件读取失败")}return!1};return(t,e)=>{const _=g("a-tag"),o=g("a-button"),w=g("a-upload"),O=g("a-input"),P=g("a-typography-link"),Q=g("a-table");return a(),D(Q,{columns:s,"data-source":c.value,scroll:{y:120},pagination:!1,"row-key":"wx_id",style:{width:"33vw"},bordered:"",ref_key:"tableRef",ref:m},{title:l(()=>[st,S("h2",it,"总数："+B(C.value),1),S("div",ot,[nt,r.value.length===0?(a(),x("h3",dt,"暂无")):E("",!0),(a(!0),x(q,null,ne(r.value,L=>(a(),D(_,{key:L,closable:"",onClose:A=>$(L)},{default:l(()=>[p(B(L),1)]),_:2},1032,["onClose"]))),128))]),S("div",ct,[i(o,{size:"small",onClick:j,disabled:r.value.length===0},{default:l(()=>[p("增加wx")]),_:1},8,["disabled"]),i(o,{size:"small",onClick:b,disabled:c.value.length===0},{default:l(()=>[p("清空")]),_:1},8,["disabled"]),i(w,{"before-upload":z,"show-upload-list":!1,accept:".txt",class:"upload-btn"},{default:l(()=>[i(o,{size:"small",disabled:r.value.length===0},{default:l(()=>[p("导入TXT文件")]),_:1},8,["disabled"])]),_:1}),i(O,{value:f.value,"onUpdate:value":e[0]||(e[0]=L=>f.value=L),placeholder:"请输入验证语",allowClear:"",size:"small",style:{width:"200px","margin-left":"10px"}},null,8,["value"]),i(o,{size:"small",onClick:e[1]||(e[1]=L=>y(f.value)),disabled:f.value===""},{default:l(()=>[p("增加验证语")]),_:1},8,["disabled"])])]),bodyCell:l(({column:L,record:A,text:R})=>[["wx_id","auth"].includes(L.dataIndex)?(a(),x("div",rt,[u[A.key]?(a(),D(O,{key:0,value:u[A.key][L.dataIndex],"onUpdate:value":V=>u[A.key][L.dataIndex]=V,style:{margin:"-5px 0"}},null,8,["value","onUpdate:value"])):(a(),x(q,{key:1},[p(B(R),1)],64))])):E("",!0),L.dataIndex==="operation"?(a(),x(q,{key:1},[u[A.key]?(a(),x("span",xt,[i(P,{onClick:V=>h(A.key)},{default:l(()=>[p("保存")]),_:2},1032,["onClick"])])):(a(),x("span",ut,[i(P,{onClick:V=>v(A.key)},{default:l(()=>[p("编辑")]),_:2},1032,["onClick"])])),i(P,{style:{"margin-left":"10px"},onClick:V=>k(A.key)},{default:l(()=>[p("删除")]),_:2},1032,["onClick"])],64)):E("",!0)]),_:1},8,["data-source"])}}}),vt=J(_t,[["__scopeId","data-v-7dd249db"]]),pt={class:"content"},ht={key:0,class:"loading"},mt={class:"device-list"},ft={class:"pagination-box"},yt=W({__name:"TotalView",setup(n){const d=we.PRESENTED_IMAGE_SIMPLE,s=I(!1),c=I(!1),r=I([]),f=I([]),m=I([]),$=I(null),M=oe(()=>{var t;return((t=$.value)==null?void 0:t.data.length)===0}),b=I({current:1,pageSize:20,total:0,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["20","30","50","80"],showTotal:t=>"共 "+t+" 条"}),C=ee(te,{style:{fontSize:"50px"},spin:!0}),u=t=>{f.value=t},v=async()=>{await k(),c.value=!0},h=async t=>{s.value=!0;const e=await pe(t);if(!e.data.data){H.error(e.data.message),s.value=!1;return}m.value=Object.keys(e.data.data).map(_=>({id:_,...e.data.data[_]})).sort((_,o)=>o.start_time-_.start_time),s.value=!1},k=async()=>{s.value=!0;const t=await X();t.data.data&&typeof t.data.data=="object"?(s.value=!1,m.value=Object.keys(t.data.data).map(e=>({id:e,...t.data.data[e]})).sort((e,_)=>_.start_time-e.start_time)):(s.value=!1,m.value=[]),s.value=!1},j=t=>{b.value.current=t,y()},y=async t=>{try{s.value=!0;let e={page:b.value.current,size:b.value.pageSize,sort:"state",order:"desc"};const _=await ve(e);_.data.data&&typeof _.data.data=="object"?(s.value=!1,r.value=_.data.data,b.value.total=_.data.total):(s.value=!1,r.value=[]);const o=await X();o.data.data&&typeof o.data.data=="object"?(s.value=!1,m.value=Object.keys(o.data.data).map(w=>({id:w,...o.data.data[w]})).sort((w,O)=>O.start_time-w.start_time)):(s.value=!1,m.value=[])}catch{s.value=!1}},T=t=>{t.state==1?window.open("/d/"+t.domain+"/","_blank"):t.stat==0?H.error("设备不在线"):H.error("没有设备连接该插槽")},z=async t=>{const e={friends:Array.from($.value.data)};if(f.value.length===0){H.error("请选择设备");return}s.value=!0;const _=await he(t,f.value.map(o=>o.domain),e);if(!_.data.data){H.error(_.data.message),s.value=!1;return}m.value=Object.keys(_.data.data).map(o=>({id:o,..._.data.data[o]})).sort((o,w)=>w.start_time-o.start_time),s.value=!1};return ae(()=>{y()}),(t,e)=>{const _=g("a-spin"),o=g("a-col"),w=g("a-row"),O=g("a-button"),P=g("a-pagination"),Q=g("a-popconfirm"),L=g("a-drawer"),A=g("a-empty");return a(),D(xe,null,{default:l(()=>[S("div",pt,[s.value?(a(),x("div",ht,[i(_,{indicator:N(C),tip:"加载中"},null,8,["indicator"])])):E("",!0),r.value.length>0?(a(),x(q,{key:1},[S("div",mt,[r.value.length?(a(),D(w,{key:0,gutter:[20,20]},{default:l(()=>[(a(!0),x(q,null,ne(r.value,R=>(a(),D(o,{key:R.domain,xs:12,sm:8,md:8,lg:6,xl:4,xxl:3},{default:l(()=>[(a(),D(Re,{key:R.domain,deviceItem:R,onClick:V=>T(R)},null,8,["deviceItem","onClick"]))]),_:2},1024))),128))]),_:1})):E("",!0)]),S("div",ft,[i(O,{type:"primary",style:{"margin-right":"50px"},size:"middle",onClick:v},{default:l(()=>[p("操作")]),_:1}),i(P,{"show-size-changer":b.value.showSizeChanger,"show-quick-jumper":b.value.showQuickJumper,current:b.value.current,"onUpdate:current":e[0]||(e[0]=R=>b.value.current=R),total:b.value.total,pageSize:b.value.pageSize,"onUpdate:pageSize":e[1]||(e[1]=R=>b.value.pageSize=R),"show-total":b.value.showTotal,pageSizeOptions:b.value.pageSizeOptions,onChange:j},null,8,["show-size-changer","show-quick-jumper","current","total","pageSize","show-total","pageSizeOptions"])]),i(L,{title:"运行脚本",placement:"bottom",open:c.value,onClose:e[5]||(e[5]=R=>c.value=!1),"body-style":{padding:"0px",margin:"0px",overflow:"hidden",height:"100%",display:"flex",justifyContent:"start",alignItems:"start"}},{extra:l(()=>[i(O,{style:{"margin-right":"8px"},onClick:e[2]||(e[2]=R=>z("addfriends")),disabled:M.value},{default:l(()=>[p("加好友")]),_:1},8,["disabled"]),i(Q,{title:"安装一台设备需要几分钟，安装完成后会生成/sdcard/Download/HttpCanary_Decypt_patched.zip模块，里面包含抓包的CA证书，请自行安装到系统然后重启","ok-text":"确认",onConfirm:e[3]||(e[3]=()=>z("env"))},{default:l(()=>[i(O,{style:{"margin-right":"8px"}},{default:l(()=>[p("安装抓包环境")]),_:1})]),_:1}),i(O,{onClick:e[4]||(e[4]=R=>z("startmitm"))},{default:l(()=>[p("开启代理")]),_:1})]),default:l(()=>[i(He,{"device-list":r.value,onSelect:u},null,8,["device-list"]),i(vt,{ref_key:"inputRef",ref:$},null,512),i(lt,{"task-list":m.value,onDelete:h,onRefresh:k},null,8,["task-list"])]),_:1},8,["open"])],64)):(a(),D(A,{key:2,image:N(d)},null,8,["image"]))])]),_:1})}}}),Ct=J(yt,[["__scopeId","data-v-36d8d5eb"]]);export{Ct as default};
