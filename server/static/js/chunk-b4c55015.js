var A=Object.defineProperty;var W=(i,e,a)=>e in i?A(i,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[e]=a;var u=(i,e,a)=>W(i,typeof e!="symbol"?e+"":e,a);import{_ as F}from"./chunk-40671842.js";import{g as H}from"./chunk-14a1bd5b.js";import{n as w,I as J,d as D,L as q,M as N,i as v,j as U,D as Q,m as f,c as y,o as c,a as p,k as b,q as k,t as E,N as G,O as L,Q as X,h as R,R as Y,l as z,A as M,F as P,E as Z,g as T}from"./chunk-fb406dfe.js";import"./chunk-a7eb19bd.js";var K={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832.6 191.4c-84.6-84.6-221.5-84.6-306 0l-96.9 96.9 51 51 96.9-96.9c53.8-53.8 144.6-59.5 204 0 59.5 59.5 53.8 150.2 0 204l-96.9 96.9 51.1 51.1 96.9-96.9c84.4-84.6 84.4-221.5-.1-306.1zM446.5 781.6c-53.8 53.8-144.6 59.5-204 0-59.5-59.5-53.8-150.2 0-204l96.9-96.9-51.1-51.1-96.9 96.9c-84.6 84.6-84.6 221.5 0 306s221.5 84.6 306 0l96.9-96.9-51-51-96.8 97zM260.3 209.4a8.03 8.03 0 00-11.3 0L209.4 249a8.03 8.03 0 000 11.3l554.4 554.4c3.1 3.1 8.2 3.1 11.3 0l39.6-39.6c3.1-3.1 3.1-8.2 0-11.3L260.3 209.4z"}}]},name:"disconnect",theme:"outlined"};function B(i){for(var e=1;e<arguments.length;e++){var a=arguments[e]!=null?Object(arguments[e]):{},n=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(n=n.concat(Object.getOwnPropertySymbols(a).filter(function(s){return Object.getOwnPropertyDescriptor(a,s).enumerable}))),n.forEach(function(s){ee(i,s,a[s])})}return i}function ee(i,e,a){return e in i?Object.defineProperty(i,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):i[e]=a,i}var j=function(e,a){var n=B({},e,a.attrs);return w(J,B({},n,{icon:K}),null)};j.displayName="DisconnectOutlined";j.inheritAttrs=!1;const te={key:1,class:"disconnect-text"},ae=["id"],se={class:"device-info"},ie={class:"domain dot"},ne={class:"brand dot"},oe=D({__name:"card",props:{deviceItem:{type:Object,default:null}},setup(i){const e=i,a=q(N,{style:{fontSize:"32px"},spin:!0}),n=v(e.deviceItem.state!=1),s=v(null);let m=null;const _=v(!1),g=v(e.deviceItem.state!=1);class S{constructor(t){u(this,"player");u(this,"base");u(this,"quality");u(this,"fps");u(this,"scale");u(this,"decoder");u(this,"live");u(this,"canvas");u(this,"image");u(this,"ctx2d");this.init(t)}async init(t){let l=0,x=0;_.value=!0;try{const{data:o,status:I}=await L({url:t.base.replace(/^ws/,"http")+"ui/stub",data:'{"method":"deviceInfo","params":[]}',method:"POST",timeout:15e3});if(_.value=!1,await X(),I===200){this.image=new Image,this.canvas=document.getElementById(t.nodeId),this.ctx2d=this.canvas.getContext("2d"),l=o.result.displayWidth,x=o.result.displayHeight,!o.result.naturalOrientation&&(l=o.result.displayHeight,x=o.result.displayWidth);const d=s.value.clientWidth,O=s.value.clientHeight,C=d/l<O/x?d/l:O/x;this.canvas.width=l,this.canvas.height=x;const $=Math.floor(l*C),V=Math.floor(x*C);this.canvas.style.width=$+"px",this.canvas.style.height=V+"px",this.base=t.base,this.quality=t.quality||25,this.fps=t.fps||10,this.scale=t.scale||.4,this.live=new WebSocket(this.base+"ws/screen/"+this.fps+"@"+this.quality+"/live?scale="+this.scale+"&type=mjpeg&backend=0"),this.live.binaryType="blob",this.live.onopen=this.onopen.bind(this),this.live.onmessage=this.onmessage.bind(this),this.live.onclose=this.onclose.bind(this),this.live.onerror=this.onerror.bind(this)}else n.value=!0}catch(o){console.log(o),n.value=!0,_.value=!1,g.value=!0}}onerror(t){console.log("onerror",t),n.value=!0,g.value=!0}onclose(t){console.log("onclose",t)}onmessage(t){var l=new Blob([t.data],{type:"image/jpeg"}),x=window.URL||window.webkitURL,o=this;this.image.onload=function(){o.ctx2d.drawImage(o.image,0,0,o.canvas.width,o.canvas.height),o.image.onload=null},this.image.src=x.createObjectURL(l)}onopen(t){L.post(this.base.replace(/^ws/,"http")+"ui/stub",JSON.stringify({method:"makeToast",params:["FireRPA control connected",0]})).then(l=>{}).catch(l=>{}),console.log("onopen:"+e.deviceItem.domain,t)}close(){this.live&&(this.live.close(),this.live=null)}}const r=async()=>{m=new S({base:location.protocol.replace("http","ws")+"//"+location.host+"/d/"+e.deviceItem.domain+"/",nodeId:"canvas-"+e.deviceItem.domain})};return U(()=>{!n.value&&r()}),Q(()=>{console.log("onUnmounted:"+e.deviceItem.domain,m),m&&m.close()}),(h,t)=>{const l=f("a-spin");return c(),y("div",{class:G(["card-content",{mask:n.value}])},[p("div",{ref_key:"canvasBox",ref:s,class:"canvas-outer"},[_.value?(c(),b(l,{key:0,indicator:k(a)},null,8,["indicator"])):g.value?(c(),y("div",te,[w(k(j),{style:{fontSize:"52px"}})])):(c(),y("canvas",{key:2,id:"canvas-"+i.deviceItem.domain},null,8,ae))],512),p("div",se,[p("div",ie,E(i.deviceItem.domain),1),p("div",ne,E(i.deviceItem.brand),1)])],2)}}}),le=R(oe,[["__scopeId","data-v-333461bf"]]),ce={class:"content"},re={key:0,class:"loading"},de={class:"device-list"},ue={class:"pagination-box"},xe=D({__name:"TotalView",setup(i){const e=Y.PRESENTED_IMAGE_SIMPLE,a=v(!1),n=v([]),s=v({current:1,pageSize:20,total:0,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["20","30","50","80"],showTotal:r=>"共 "+r+" 条"}),m=q(N,{style:{fontSize:"50px"},spin:!0}),_=r=>{s.value.current=r,g()},g=async r=>{try{a.value=!0;let h={page:s.value.current,size:s.value.pageSize,sort:"state",order:"desc"};const t=await H(h);t.data.data&&typeof t.data.data=="object"?(a.value=!1,n.value=t.data.data,s.value.total=t.data.total):(a.value=!1,n.value=[])}catch{a.value=!1}},S=r=>{r.state==1?window.open("/d/"+r.domain+"/","_blank"):r.stat==0?T.error("设备不在线"):T.error("没有设备连接该插槽")};return U(()=>{g()}),(r,h)=>{const t=f("a-spin"),l=f("a-col"),x=f("a-row"),o=f("a-pagination"),I=f("a-empty");return c(),b(F,null,{default:z(()=>[p("div",ce,[a.value?(c(),y("div",re,[w(t,{indicator:k(m),tip:"加载中"},null,8,["indicator"])])):M("",!0),n.value.length>0?(c(),y(P,{key:1},[p("div",de,[n.value.length?(c(),b(x,{key:0,gutter:[20,20]},{default:z(()=>[(c(!0),y(P,null,Z(n.value,d=>(c(),b(l,{key:d.domain,xs:12,sm:8,md:8,lg:6,xl:4,xxl:3},{default:z(()=>[(c(),b(le,{key:d.domain,deviceItem:d,onClick:O=>S(d)},null,8,["deviceItem","onClick"]))]),_:2},1024))),128))]),_:1})):M("",!0)]),p("div",ue,[w(o,{"show-size-changer":s.value.showSizeChanger,"show-quick-jumper":s.value.showQuickJumper,current:s.value.current,"onUpdate:current":h[0]||(h[0]=d=>s.value.current=d),total:s.value.total,pageSize:s.value.pageSize,"onUpdate:pageSize":h[1]||(h[1]=d=>s.value.pageSize=d),"show-total":s.value.showTotal,pageSizeOptions:s.value.pageSizeOptions,onChange:_},null,8,["show-size-changer","show-quick-jumper","current","total","pageSize","show-total","pageSizeOptions"])])],64)):(c(),b(I,{key:2,image:k(e)},null,8,["image"]))])]),_:1})}}}),ge=R(xe,[["__scopeId","data-v-2023efcc"]]);export{ge as default};
