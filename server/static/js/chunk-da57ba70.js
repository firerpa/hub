var ce=Object.defineProperty;var re=(n,d,l)=>d in n?ce(n,d,{enumerable:!0,configurable:!0,writable:!0,value:l}):n[d]=l;var P=(n,d,l)=>re(n,typeof d!="symbol"?d+"":d,l);import{_ as xe}from"./chunk-4308f9b2.js";import{H as ue,c as _e,g as ve,b as X,e as he,f as pe}from"./chunk-7c725460.js";import{n as i,I as me,d as V,L as ee,M as te,i as C,j as ae,D as fe,m as k,c as _,o as a,a as z,k as E,q as A,t as B,N as ye,O as Y,Q as le,h as W,l as s,A as M,F as q,w as H,f as h,C as ge,B as be,g as N,p as se,e as ie,y as oe,r as ke,E as ne,R as Z,S as we}from"./chunk-efddd1a4.js";import{a as Ie}from"./chunk-1c9c11ae.js";var Ce={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832.6 191.4c-84.6-84.6-221.5-84.6-306 0l-96.9 96.9 51 51 96.9-96.9c53.8-53.8 144.6-59.5 204 0 59.5 59.5 53.8 150.2 0 204l-96.9 96.9 51.1 51.1 96.9-96.9c84.4-84.6 84.4-221.5-.1-306.1zM446.5 781.6c-53.8 53.8-144.6 59.5-204 0-59.5-59.5-53.8-150.2 0-204l96.9-96.9-51.1-51.1-96.9 96.9c-84.6 84.6-84.6 221.5 0 306s221.5 84.6 306 0l96.9-96.9-51-51-96.8 97zM260.3 209.4a8.03 8.03 0 00-11.3 0L209.4 249a8.03 8.03 0 000 11.3l554.4 554.4c3.1 3.1 8.2 3.1 11.3 0l39.6-39.6c3.1-3.1 3.1-8.2 0-11.3L260.3 209.4z"}}]},name:"disconnect",theme:"outlined"};function K(n){for(var d=1;d<arguments.length;d++){var l=arguments[d]!=null?Object(arguments[d]):{},c=Object.keys(l);typeof Object.getOwnPropertySymbols=="function"&&(c=c.concat(Object.getOwnPropertySymbols(l).filter(function(r){return Object.getOwnPropertyDescriptor(l,r).enumerable}))),c.forEach(function(r){Oe(n,r,l[r])})}return n}function Oe(n,d,l){return d in n?Object.defineProperty(n,d,{value:l,enumerable:!0,configurable:!0,writable:!0}):n[d]=l,n}var Q=function(d,l){var c=K({},d,l.attrs);return i(me,K({},c,{icon:Ce}),null)};Q.displayName="DisconnectOutlined";Q.inheritAttrs=!1;const Se={key:1,class:"disconnect-text"},$e=["id"],ze={class:"device-info"},je={class:"domain dot"},Te={class:"brand dot"},Le=V({__name:"card",props:{deviceItem:{type:Object,default:null}},setup(n){const d=n,l=ee(te,{style:{fontSize:"32px"},spin:!0}),c=C(d.deviceItem.state!=1),r=C(null);let f=null;const p=C(!1),j=C(d.deviceItem.state!=1);class U{constructor(x){P(this,"player");P(this,"base");P(this,"quality");P(this,"fps");P(this,"scale");P(this,"decoder");P(this,"live");P(this,"canvas");P(this,"image");P(this,"ctx2d");this.init(x)}async init(x){let v=0,m=0;p.value=!0;try{const{data:b,status:T}=await Y({url:x.base.replace(/^ws/,"http")+"ui/stub",data:'{"method":"deviceInfo","params":[]}',method:"POST",timeout:15e3});if(p.value=!1,await le(),T===200){this.image=new Image,this.canvas=document.getElementById(x.nodeId),this.ctx2d=this.canvas.getContext("2d"),v=b.result.displayWidth,m=b.result.displayHeight,!b.result.naturalOrientation&&(v=b.result.displayHeight,m=b.result.displayWidth);const y=r.value.clientWidth,L=r.value.clientHeight,S=y/v<L/m?y/v:L/m;this.canvas.width=v,this.canvas.height=m;const t=Math.floor(v*S),e=Math.floor(m*S);this.canvas.style.width=t+"px",this.canvas.style.height=e+"px",this.base=x.base,this.quality=x.quality||25,this.fps=x.fps||10,this.scale=x.scale||.4,this.live=new WebSocket(this.base+"ws/screen/"+this.fps+"@"+this.quality+"/live?scale="+this.scale+"&type=mjpeg&backend=0"),this.live.binaryType="blob",this.live.onopen=this.onopen.bind(this),this.live.onmessage=this.onmessage.bind(this),this.live.onclose=this.onclose.bind(this),this.live.onerror=this.onerror.bind(this)}else c.value=!0}catch(b){console.log(b),c.value=!0,p.value=!1,j.value=!0}}onerror(x){console.log("onerror",x),c.value=!0,j.value=!0}onclose(x){console.log("onclose",x)}onmessage(x){var v=new Blob([x.data],{type:"image/jpeg"}),m=window.URL||window.webkitURL,b=this;this.image.onload=function(){b.ctx2d.drawImage(b.image,0,0,b.canvas.width,b.canvas.height),b.image.onload=null},this.image.src=m.createObjectURL(v)}onopen(x){Y.post(this.base.replace(/^ws/,"http")+"ui/stub",JSON.stringify({method:"makeToast",params:["FireRPA control connected",0]})).then(v=>{}).catch(v=>{}),console.log("onopen:"+d.deviceItem.domain,x)}close(){this.live&&(this.live.close(),this.live=null)}}const g=async()=>{f=new U({base:location.protocol.replace("http","ws")+"//"+location.host+"/d/"+d.deviceItem.domain+"/",nodeId:"canvas-"+d.deviceItem.domain})};return ae(()=>{!c.value&&g()}),fe(()=>{console.log("onUnmounted:"+d.deviceItem.domain,f),f&&f.close()}),(O,x)=>{const v=k("a-spin");return a(),_("div",{class:ye(["card-content",{mask:c.value}])},[z("div",{ref_key:"canvasBox",ref:r,class:"canvas-outer"},[p.value?(a(),E(v,{key:0,indicator:A(l)},null,8,["indicator"])):j.value?(a(),_("div",Se,[i(A(Q),{style:{fontSize:"52px"}})])):(a(),_("canvas",{key:2,id:"canvas-"+n.deviceItem.domain},null,8,$e))],512),z("div",ze,[z("div",je,B(n.deviceItem.domain),1),z("div",Te,B(n.deviceItem.brand),1)])],2)}}}),Re=W(Le,[["__scopeId","data-v-333461bf"]]),Ee=n=>(se("data-v-eb8a7c45"),n=n(),ie(),n),Me=Ee(()=>z("h4",null,"选择设备",-1)),Ue={key:0,class:"comment-cell"},Pe={class:"comment-text"},De={key:1,class:"edit-line"},Be={key:0},qe={key:1},Ae={key:2},Ne=V({__name:"selected",props:{deviceList:{type:Array,default:[]}},emits:["select"],setup(n,{emit:d}){var b;const l=(b=Ie.getUser())==null?void 0:b.admin,c=n,r=C(!1),f=C(-1),p=C(""),j=(T,y)=>{f.value=T,p.value=y,r.value=!0},U=d,g=C([]),O=T=>{g.value=T;const y=c.deviceList.filter(L=>T.includes(L.domain));U("select",y)},x=[{title:"设备域名",dataIndex:"domain"},{title:"品牌",dataIndex:"brand"},{title:"型号",dataIndex:"device"},{title:"备注",dataIndex:"comment"},{title:"状态",dataIndex:"state"}],v=async T=>{var y,L;if(T==="save"&&f.value!==-1)try{const S=await _e(c.deviceList[f.value].domain,p.value);((y=S==null?void 0:S.data)==null?void 0:y.status)==0?(c.deviceList[f.value].comment=p.value,N.success("修改成功")):N.error("修改失败："+((L=S==null?void 0:S.data)==null?void 0:L.message))}finally{m()}else T==="cancel"&&m()},m=()=>{f.value=-1,p.value="",r.value=!1};return(T,y)=>{const L=k("a-tooltip"),S=k("a-input"),t=k("a-tag"),e=k("a-table");return a(),E(e,{columns:x,"data-source":n.deviceList,scroll:{y:200},"row-selection":{selectedRowKeys:g.value,onChange:O,getCheckboxProps:u=>({disabled:u.state!==1})},pagination:!1,"row-key":"domain",style:{width:"33vw"}},{title:s(()=>[Me]),bodyCell:s(({column:u,record:o,index:w,text:$})=>[u.dataIndex==="comment"?(a(),_(q,{key:0},[!r.value||f.value!==w?(a(),_("div",Ue,[i(L,{placement:"right"},{title:s(()=>[h(B($||""),1)]),default:s(()=>[A(l)?(a(),E(A(ue),{key:0,class:"edit-icon",onClick:H(D=>j(w,o.comment),["stop"])},null,8,["onClick"])):M("",!0),z("span",Pe,B($||""),1)]),_:2},1024)])):(a(),_("div",De,[i(S,{value:p.value,onClick:y[0]||(y[0]=H(()=>{},["stop"])),onInput:y[1]||(y[1]=H(D=>p.value=D.target.value,["stop"]))},null,8,["value"]),i(A(ge),{class:"ico",onClick:y[2]||(y[2]=H(D=>v("save"),["stop"]))}),i(A(be),{class:"ico",onClick:y[3]||(y[3]=H(D=>v("cancel"),["stop"]))})]))],64)):M("",!0),u.dataIndex==="state"?(a(),_(q,{key:1},[o.state===1?(a(),_("div",Be,[i(t,{color:"green"},{default:s(()=>[h("在线")]),_:1})])):o.state===0?(a(),_("div",qe,[i(t,{color:"red"},{default:s(()=>[h("离线")]),_:1})])):(a(),_("div",Ae,[i(t,{color:"gray"},{default:s(()=>[h("未知")]),_:1})]))],64)):M("",!0)]),_:1},8,["data-source","row-selection"])}}}),He=W(Ne,[["__scopeId","data-v-eb8a7c45"]]),Ve=z("h2",null,"任务列表",-1),Fe=z("span",{style:{color:"orange"}},"输出",-1),We={key:0},Je={key:0},Qe={key:0},Ge={key:1},Xe={key:0},Ye={key:1},Ze={key:2},Ke={key:3},et={key:4},tt=V({__name:"tasks",props:{taskList:{type:Array,default:[]}},emits:["delete","refresh"],setup(n,{emit:d}){const l=p=>{r("delete",p)},c=()=>{r("refresh")},r=d,f=[{title:"脚本路径",dataIndex:"script_path"},{title:"开始时间",dataIndex:"start_date"},{title:"结束时间",dataIndex:"end_date"},{title:"流程",dataIndex:"status"},{title:"状态",dataIndex:"result"},{title:"操作",dataIndex:"operating"}];return(p,j)=>{const U=k("a-button"),g=k("a-typography-link"),O=k("a-tag"),x=k("a-table");return a(),E(x,{columns:f,"data-source":n.taskList,scroll:{y:180},pagination:!1,"row-key":"id",style:{width:"33vw"},bordered:""},{title:s(()=>[Ve,i(U,{size:"small",onClick:c},{default:s(()=>[h("刷新")]),_:1}),i(U,{size:"small",danger:"",style:{"margin-left":"10px"},onClick:j[0]||(j[0]=v=>l(null))},{default:s(()=>[h("清除")]),_:1})]),expandColumnTitle:s(()=>[Fe]),expandedRowRender:s(({record:v})=>[v.result?(a(),_("p",We,B(v.result.return_code===0?v.result.stdout:v.result.stderr),1)):M("",!0)]),bodyCell:s(({column:v,record:m})=>[v.dataIndex==="operating"?(a(),E(g,{key:0,onClick:b=>l(m.id)},{default:s(()=>[h(B(m.status==="running"?"终止":"删除"),1)]),_:2},1032,["onClick"])):v.dataIndex==="result"?(a(),_(q,{key:1},[m.result?(a(),_("div",Je,[m.result.return_code===0?(a(),_("div",Qe,[i(O,{color:"green"},{default:s(()=>[h("正常")]),_:1})])):(a(),_("div",Ge,[i(O,{color:"red"},{default:s(()=>[h("异常")]),_:1})]))])):M("",!0)],64)):M("",!0),v.dataIndex==="status"?(a(),_(q,{key:2},[m.status==="completed"?(a(),_("div",Xe,[i(O,{color:"green"},{default:s(()=>[h("完成")]),_:1})])):m.status==="error"?(a(),_("div",Ye,[i(O,{color:"red"},{default:s(()=>[h("异常")]),_:1})])):m.status==="running"?(a(),_("div",Ze,[i(O,{color:"orange"},{default:s(()=>[h("运行中")]),_:1})])):m.status==="cancelled"?(a(),_("div",Ke,[i(O,{color:"default"},{default:s(()=>[h("已终止")]),_:1})])):(a(),_("div",et,[i(O,{color:"red"},{default:s(()=>[h("超时")]),_:1})]))],64)):M("",!0)]),_:1},8,["data-source"])}}}),de=n=>(se("data-v-7dd249db"),n=n(),ie(),n),at=de(()=>z("h2",null,"待添加好友列表",-1)),lt={style:{float:"right"}},st={class:"auth-content"},it=de(()=>z("h3",null,"验证语：",-1)),ot={key:0},nt={class:"toolbar"},dt={key:0},ct={key:0},rt={key:1},xt=V({__name:"input",setup(n,{expose:d}){const l=[{title:"微信号",dataIndex:"wx_id"},{title:"验证语",dataIndex:"auth"},{title:"操作",dataIndex:"operation"}],c=C([]),r=C([]),f=C(""),p=C(),j=t=>{r.value=r.value.filter(e=>e!==t)},U=()=>{let t="";if(r.value.length>0){const e=Math.floor(Math.random()*r.value.length);t=r.value[e]}return t};d({data:c});const g=()=>{c.value=[]},O=oe(()=>c.value.length),x=ke({}),v=t=>{x[t]=Z(c.value.filter(e=>t===e.key)[0])},m=t=>{Object.assign(c.value.filter(e=>t===e.key)[0],x[t]),delete x[t]},b=t=>{c.value=c.value.filter(e=>t!==e.key)},T=()=>{let t=U();const e={key:""+(O.value+1),wx_id:"",auth:t};c.value.push(e),x[e.key]=Z(e),le(()=>{var o;const u=(o=p.value)==null?void 0:o.$el;if(u){const w=u.querySelector(".ant-table-body");w&&(w.scrollTop=w.scrollHeight)}})},y=t=>{r.value.push(t),f.value=""},L=t=>new Promise((e,u)=>{const o=new FileReader;o.onload=w=>{var $;e(($=w.target)==null?void 0:$.result)},o.onerror=u,o.readAsText(t,"UTF-8")}),S=async t=>{try{(await L(t)).split(/\r?\n/).filter(o=>o.trim()!=="").forEach((o,w)=>{const $=U();c.value.push({key:""+(O.value+1),wx_id:o.trim(),auth:$})})}catch(e){throw console.error("文件读取失败:",e),new Error("文件读取失败")}return!1};return(t,e)=>{const u=k("a-tag"),o=k("a-button"),w=k("a-upload"),$=k("a-input"),D=k("a-typography-link"),J=k("a-table");return a(),E(J,{columns:l,"data-source":c.value,scroll:{y:120},pagination:!1,"row-key":"wx_id",style:{width:"33vw"},bordered:"",ref_key:"tableRef",ref:p},{title:s(()=>[at,z("h2",lt,"总数："+B(O.value),1),z("div",st,[it,r.value.length===0?(a(),_("h3",ot,"暂无")):M("",!0),(a(!0),_(q,null,ne(r.value,R=>(a(),E(u,{key:R,closable:"",onClose:I=>j(R)},{default:s(()=>[h(B(R),1)]),_:2},1032,["onClose"]))),128))]),z("div",nt,[i(o,{size:"small",onClick:T,disabled:r.value.length===0},{default:s(()=>[h("增加wx")]),_:1},8,["disabled"]),i(o,{size:"small",onClick:g,disabled:c.value.length===0},{default:s(()=>[h("清空")]),_:1},8,["disabled"]),i(w,{"before-upload":S,"show-upload-list":!1,accept:".txt",class:"upload-btn"},{default:s(()=>[i(o,{size:"small",disabled:r.value.length===0},{default:s(()=>[h("导入TXT文件")]),_:1},8,["disabled"])]),_:1}),i($,{value:f.value,"onUpdate:value":e[0]||(e[0]=R=>f.value=R),placeholder:"请输入验证语",allowClear:"",size:"small",style:{width:"200px","margin-left":"10px"}},null,8,["value"]),i(o,{size:"small",onClick:e[1]||(e[1]=R=>y(f.value)),disabled:f.value===""},{default:s(()=>[h("增加验证语")]),_:1},8,["disabled"])])]),bodyCell:s(({column:R,record:I,text:G})=>[["wx_id","auth"].includes(R.dataIndex)?(a(),_("div",dt,[x[I.key]?(a(),E($,{key:0,value:x[I.key][R.dataIndex],"onUpdate:value":F=>x[I.key][R.dataIndex]=F,style:{margin:"-5px 0"}},null,8,["value","onUpdate:value"])):(a(),_(q,{key:1},[h(B(G),1)],64))])):M("",!0),R.dataIndex==="operation"?(a(),_(q,{key:1},[x[I.key]?(a(),_("span",ct,[i(D,{onClick:F=>m(I.key)},{default:s(()=>[h("保存")]),_:2},1032,["onClick"])])):(a(),_("span",rt,[i(D,{onClick:F=>v(I.key)},{default:s(()=>[h("编辑")]),_:2},1032,["onClick"])])),i(D,{style:{"margin-left":"10px"},onClick:F=>b(I.key)},{default:s(()=>[h("删除")]),_:2},1032,["onClick"])],64)):M("",!0)]),_:1},8,["data-source"])}}}),ut=W(xt,[["__scopeId","data-v-7dd249db"]]),_t={class:"content"},vt={key:0,class:"loading"},ht={class:"device-list"},pt={class:"pagination-box"},mt=V({__name:"TotalView",setup(n){const d=we.PRESENTED_IMAGE_SIMPLE,l=C(!1),c=C(!1),r=C([]),f=C([]),p=C([]),j=C(null),U=oe(()=>{var t;return((t=j.value)==null?void 0:t.data.length)===0}),g=C({current:1,pageSize:20,total:0,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["20","30","50","80"],showTotal:t=>"共 "+t+" 条"}),O=ee(te,{style:{fontSize:"50px"},spin:!0}),x=t=>{f.value=t},v=async()=>{await b(),c.value=!0},m=async t=>{l.value=!0;const e=await he(t);if(!e.data.data){N.error(e.data.message),l.value=!1;return}p.value=Object.keys(e.data.data).map(u=>({id:u,...e.data.data[u]})).sort((u,o)=>o.start_time-u.start_time),l.value=!1},b=async()=>{l.value=!0;const t=await X();t.data.data&&typeof t.data.data=="object"?(l.value=!1,p.value=Object.keys(t.data.data).map(e=>({id:e,...t.data.data[e]})).sort((e,u)=>u.start_time-e.start_time)):(l.value=!1,p.value=[]),l.value=!1},T=t=>{g.value.current=t,y()},y=async t=>{try{l.value=!0;let e={page:g.value.current,size:g.value.pageSize,sort:"state",order:"desc"};const u=await ve(e);u.data.data&&typeof u.data.data=="object"?(l.value=!1,r.value=u.data.data,g.value.total=u.data.total):(l.value=!1,r.value=[]);const o=await X();o.data.data&&typeof o.data.data=="object"?(l.value=!1,p.value=Object.keys(o.data.data).map(w=>({id:w,...o.data.data[w]})).sort((w,$)=>$.start_time-w.start_time)):(l.value=!1,p.value=[])}catch{l.value=!1}},L=t=>{t.state==1?window.open("/d/"+t.domain+"/","_blank"):t.stat==0?N.error("设备不在线"):N.error("没有设备连接该插槽")},S=async t=>{const e={friends:Array.from(j.value.data)};if(f.value.length===0){N.error("请选择设备");return}l.value=!0;const u=await pe(t,f.value.map(o=>o.domain),e);if(!u.data.data){N.error(u.data.message),l.value=!1;return}p.value=Object.keys(u.data.data).map(o=>({id:o,...u.data.data[o]})).sort((o,w)=>w.start_time-o.start_time),l.value=!1};return ae(()=>{y()}),(t,e)=>{const u=k("a-spin"),o=k("a-col"),w=k("a-row"),$=k("a-button"),D=k("a-pagination"),J=k("a-drawer"),R=k("a-empty");return a(),E(xe,null,{default:s(()=>[z("div",_t,[l.value?(a(),_("div",vt,[i(u,{indicator:A(O),tip:"加载中"},null,8,["indicator"])])):M("",!0),r.value.length>0?(a(),_(q,{key:1},[z("div",ht,[r.value.length?(a(),E(w,{key:0,gutter:[20,20]},{default:s(()=>[(a(!0),_(q,null,ne(r.value,I=>(a(),E(o,{key:I.domain,xs:12,sm:8,md:8,lg:6,xl:4,xxl:3},{default:s(()=>[(a(),E(Re,{key:I.domain,deviceItem:I,onClick:G=>L(I)},null,8,["deviceItem","onClick"]))]),_:2},1024))),128))]),_:1})):M("",!0)]),z("div",pt,[i($,{type:"primary",style:{"margin-right":"50px"},size:"middle",onClick:v},{default:s(()=>[h("操作")]),_:1}),i(D,{"show-size-changer":g.value.showSizeChanger,"show-quick-jumper":g.value.showQuickJumper,current:g.value.current,"onUpdate:current":e[0]||(e[0]=I=>g.value.current=I),total:g.value.total,pageSize:g.value.pageSize,"onUpdate:pageSize":e[1]||(e[1]=I=>g.value.pageSize=I),"show-total":g.value.showTotal,pageSizeOptions:g.value.pageSizeOptions,onChange:T},null,8,["show-size-changer","show-quick-jumper","current","total","pageSize","show-total","pageSizeOptions"])]),i(J,{title:"运行脚本",placement:"bottom",open:c.value,onClose:e[4]||(e[4]=I=>c.value=!1),"body-style":{padding:"0px",margin:"0px",overflow:"hidden",height:"100%",display:"flex",justifyContent:"start",alignItems:"start"}},{extra:s(()=>[i($,{style:{"margin-right":"8px"},onClick:e[2]||(e[2]=I=>S("addfriends")),disabled:U.value},{default:s(()=>[h("加好友")]),_:1},8,["disabled"]),i($,{onClick:e[3]||(e[3]=I=>S("toast"))},{default:s(()=>[h("Toast")]),_:1})]),default:s(()=>[i(He,{"device-list":r.value,onSelect:x},null,8,["device-list"]),i(ut,{ref_key:"inputRef",ref:j},null,512),i(tt,{"task-list":p.value,onDelete:m,onRefresh:b},null,8,["task-list"])]),_:1},8,["open"])],64)):(a(),E(R,{key:2,image:A(d)},null,8,["image"]))])]),_:1})}}}),wt=W(mt,[["__scopeId","data-v-085806c3"]]);export{wt as default};
