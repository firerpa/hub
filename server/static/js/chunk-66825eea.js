var ie=Object.defineProperty;var ne=(c,i,a)=>i in c?ie(c,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):c[i]=a;var L=(c,i,a)=>ne(c,typeof i!="symbol"?i+"":i,a);import{_ as de}from"./chunk-1fb65db0.js";import{g as re,b as G,e as ce,f as xe}from"./chunk-85253a6b.js";import{n as r,I as ue,d as N,L as K,M as ee,i as z,j as te,D as _e,m as f,c as _,o as l,a as S,k as T,q as F,t as D,N as ve,O as X,Q as ae,h as W,l as s,A as R,F as E,f as p,y as le,r as he,E as se,R as Y,p as pe,e as me,S as ye,g as B}from"./chunk-e61ca45f.js";import"./chunk-a7eb19bd.js";var fe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832.6 191.4c-84.6-84.6-221.5-84.6-306 0l-96.9 96.9 51 51 96.9-96.9c53.8-53.8 144.6-59.5 204 0 59.5 59.5 53.8 150.2 0 204l-96.9 96.9 51.1 51.1 96.9-96.9c84.4-84.6 84.4-221.5-.1-306.1zM446.5 781.6c-53.8 53.8-144.6 59.5-204 0-59.5-59.5-53.8-150.2 0-204l96.9-96.9-51.1-51.1-96.9 96.9c-84.6 84.6-84.6 221.5 0 306s221.5 84.6 306 0l96.9-96.9-51-51-96.8 97zM260.3 209.4a8.03 8.03 0 00-11.3 0L209.4 249a8.03 8.03 0 000 11.3l554.4 554.4c3.1 3.1 8.2 3.1 11.3 0l39.6-39.6c3.1-3.1 3.1-8.2 0-11.3L260.3 209.4z"}}]},name:"disconnect",theme:"outlined"};function Z(c){for(var i=1;i<arguments.length;i++){var a=arguments[i]!=null?Object(arguments[i]):{},x=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(x=x.concat(Object.getOwnPropertySymbols(a).filter(function(n){return Object.getOwnPropertyDescriptor(a,n).enumerable}))),x.forEach(function(n){ge(c,n,a[n])})}return c}function ge(c,i,a){return i in c?Object.defineProperty(c,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):c[i]=a,c}var J=function(i,a){var x=Z({},i,a.attrs);return r(ue,Z({},x,{icon:fe}),null)};J.displayName="DisconnectOutlined";J.inheritAttrs=!1;const ke={key:1,class:"disconnect-text"},be=["id"],we={class:"device-info"},Ie={class:"domain dot"},Ce={class:"brand dot"},ze=N({__name:"card",props:{deviceItem:{type:Object,default:null}},setup(c){const i=c,a=K(ee,{style:{fontSize:"32px"},spin:!0}),x=z(i.deviceItem.state!=1),n=z(null);let b=null;const m=z(!1),I=z(i.deviceItem.state!=1);class j{constructor(o){L(this,"player");L(this,"base");L(this,"quality");L(this,"fps");L(this,"scale");L(this,"decoder");L(this,"live");L(this,"canvas");L(this,"image");L(this,"ctx2d");this.init(o)}async init(o){let u=0,g=0;m.value=!0;try{const{data:k,status:q}=await X({url:o.base.replace(/^ws/,"http")+"ui/stub",data:'{"method":"deviceInfo","params":[]}',method:"POST",timeout:15e3});if(m.value=!1,await ae(),q===200){this.image=new Image,this.canvas=document.getElementById(o.nodeId),this.ctx2d=this.canvas.getContext("2d"),u=k.result.displayWidth,g=k.result.displayHeight,!k.result.naturalOrientation&&(u=k.result.displayHeight,g=k.result.displayWidth);const M=n.value.clientWidth,U=n.value.clientHeight,P=M/u<U/g?M/u:U/g;this.canvas.width=u,this.canvas.height=g;const t=Math.floor(u*P),e=Math.floor(g*P);this.canvas.style.width=t+"px",this.canvas.style.height=e+"px",this.base=o.base,this.quality=o.quality||25,this.fps=o.fps||10,this.scale=o.scale||.4,this.live=new WebSocket(this.base+"ws/screen/"+this.fps+"@"+this.quality+"/live?scale="+this.scale+"&type=mjpeg&backend=0"),this.live.binaryType="blob",this.live.onopen=this.onopen.bind(this),this.live.onmessage=this.onmessage.bind(this),this.live.onclose=this.onclose.bind(this),this.live.onerror=this.onerror.bind(this)}else x.value=!0}catch(k){console.log(k),x.value=!0,m.value=!1,I.value=!0}}onerror(o){console.log("onerror",o),x.value=!0,I.value=!0}onclose(o){console.log("onclose",o)}onmessage(o){var u=new Blob([o.data],{type:"image/jpeg"}),g=window.URL||window.webkitURL,k=this;this.image.onload=function(){k.ctx2d.drawImage(k.image,0,0,k.canvas.width,k.canvas.height),k.image.onload=null},this.image.src=g.createObjectURL(u)}onopen(o){X.post(this.base.replace(/^ws/,"http")+"ui/stub",JSON.stringify({method:"makeToast",params:["FireRPA control connected",0]})).then(u=>{}).catch(u=>{}),console.log("onopen:"+i.deviceItem.domain,o)}close(){this.live&&(this.live.close(),this.live=null)}}const h=async()=>{b=new j({base:location.protocol.replace("http","ws")+"//"+location.host+"/d/"+i.deviceItem.domain+"/",nodeId:"canvas-"+i.deviceItem.domain})};return te(()=>{!x.value&&h()}),_e(()=>{console.log("onUnmounted:"+i.deviceItem.domain,b),b&&b.close()}),(C,o)=>{const u=f("a-spin");return l(),_("div",{class:ve(["card-content",{mask:x.value}])},[S("div",{ref_key:"canvasBox",ref:n,class:"canvas-outer"},[m.value?(l(),T(u,{key:0,indicator:F(a)},null,8,["indicator"])):I.value?(l(),_("div",ke,[r(F(J),{style:{fontSize:"52px"}})])):(l(),_("canvas",{key:2,id:"canvas-"+c.deviceItem.domain},null,8,be))],512),S("div",we,[S("div",Ie,D(c.deviceItem.domain),1),S("div",Ce,D(c.deviceItem.brand),1)])],2)}}}),Se=W(ze,[["__scopeId","data-v-333461bf"]]),Oe=S("h4",null,"选择设备",-1),$e={key:0},je={key:1},Te={key:2},Le=N({__name:"selected",props:{deviceList:{type:Array,default:[]}},emits:["select"],setup(c,{emit:i}){const a=c,x=i,n=z([]),b=I=>{n.value=I;const j=a.deviceList.filter(h=>I.includes(h.domain));x("select",j)},m=[{title:"设备域名",dataIndex:"domain"},{title:"品牌",dataIndex:"brand"},{title:"型号",dataIndex:"device"},{title:"状态",dataIndex:"state"}];return(I,j)=>{const h=f("a-tag"),C=f("a-table");return l(),T(C,{columns:m,"data-source":c.deviceList,scroll:{y:200},"row-selection":{selectedRowKeys:n.value,onChange:b,getCheckboxProps:o=>({disabled:o.state!==1})},pagination:!1,"row-key":"domain",style:{width:"33vw"}},{title:s(()=>[Oe]),bodyCell:s(({column:o,record:u})=>[o.dataIndex==="state"?(l(),_(E,{key:0},[u.state===1?(l(),_("div",$e,[r(h,{color:"green"},{default:s(()=>[p("在线")]),_:1})])):u.state===0?(l(),_("div",je,[r(h,{color:"red"},{default:s(()=>[p("离线")]),_:1})])):(l(),_("div",Te,[r(h,{color:"gray"},{default:s(()=>[p("未知")]),_:1})]))],64)):R("",!0)]),_:1},8,["data-source","row-selection"])}}}),Re=S("h2",null,"任务列表",-1),Ee=S("span",{style:{color:"orange"}},"输出",-1),Me={key:0},Pe={key:0},Ue={key:0},De={key:1},qe={key:0},Ae={key:1},Be={key:2},Ne={key:3},Ve=N({__name:"tasks",props:{taskList:{type:Array,default:[]}},emits:["delete","refresh"],setup(c,{emit:i}){const a=m=>{n("delete",m)},x=()=>{n("refresh")},n=i,b=[{title:"脚本路径",dataIndex:"script_path"},{title:"开始时间",dataIndex:"start_date"},{title:"结束时间",dataIndex:"end_date"},{title:"流程",dataIndex:"status"},{title:"状态",dataIndex:"result"},{title:"操作",dataIndex:"operating"}];return(m,I)=>{const j=f("a-button"),h=f("a-typography-link"),C=f("a-tag"),o=f("a-table");return l(),T(o,{columns:b,"data-source":c.taskList,scroll:{y:180},pagination:!1,"row-key":"id",style:{width:"33vw"},bordered:""},{title:s(()=>[Re,r(j,{size:"small",onClick:x},{default:s(()=>[p("刷新")]),_:1}),r(j,{size:"small",danger:"",style:{"margin-left":"10px"},onClick:I[0]||(I[0]=u=>a(null))},{default:s(()=>[p("清除")]),_:1})]),expandColumnTitle:s(()=>[Ee]),expandedRowRender:s(({record:u})=>[u.result?(l(),_("p",Me,D(u.result.return_code===0?u.result.stdout:u.result.stderr),1)):R("",!0)]),bodyCell:s(({column:u,record:g})=>[u.dataIndex==="operating"?(l(),T(h,{key:0,onClick:k=>a(g.id)},{default:s(()=>[p("删除")]),_:2},1032,["onClick"])):u.dataIndex==="result"?(l(),_(E,{key:1},[g.result?(l(),_("div",Pe,[g.result.return_code===0?(l(),_("div",Ue,[r(C,{color:"green"},{default:s(()=>[p("正常")]),_:1})])):(l(),_("div",De,[r(C,{color:"red"},{default:s(()=>[p("异常")]),_:1})]))])):R("",!0)],64)):R("",!0),u.dataIndex==="status"?(l(),_(E,{key:2},[g.status==="completed"?(l(),_("div",qe,[r(C,{color:"green"},{default:s(()=>[p("完成")]),_:1})])):g.status==="error"?(l(),_("div",Ae,[r(C,{color:"red"},{default:s(()=>[p("异常")]),_:1})])):g.status==="running"?(l(),_("div",Be,[r(C,{color:"orange"},{default:s(()=>[p("运行中")]),_:1})])):(l(),_("div",Ne,[r(C,{color:"red"},{default:s(()=>[p("超时")]),_:1})]))],64)):R("",!0)]),_:1},8,["data-source"])}}}),oe=c=>(pe("data-v-dc65ccbe"),c=c(),me(),c),Fe=oe(()=>S("h2",null,"待添加好友列表",-1)),He={style:{float:"right"}},We={class:"auth-content"},Je=oe(()=>S("h3",null,"验证语：",-1)),Qe={key:0},Ge={class:"toolbar"},Xe={key:0},Ye={key:0},Ze={key:1},Ke=N({__name:"input",setup(c,{expose:i}){const a=[{title:"微信号",dataIndex:"wx_id"},{title:"验证语",dataIndex:"auth"},{title:"操作",dataIndex:"operation"}],x=z([{key:"1",wx_id:"__int64",auth:"hello"}]),n=z([]),b=z(""),m=z(),I=t=>{n.value=n.value.filter(e=>e!==t)},j=()=>{let t="";if(n.value.length>0){const e=Math.floor(Math.random()*n.value.length);t=n.value[e]}return t};i({data:x});const h=()=>{x.value=[]},C=le(()=>x.value.length),o=he({}),u=t=>{o[t]=Y(x.value.filter(e=>t===e.key)[0])},g=t=>{Object.assign(x.value.filter(e=>t===e.key)[0],o[t]),delete o[t]},k=t=>{x.value=x.value.filter(e=>t!==e.key)},q=()=>{let t=j();const e={key:""+(C.value+1),wx_id:"",auth:t};x.value.push(e),o[e.key]=Y(e),ae(()=>{var d;const v=(d=m.value)==null?void 0:d.$el;if(v){const w=v.querySelector(".ant-table-body");w&&(w.scrollTop=w.scrollHeight)}})},M=t=>{n.value.push(t),b.value=""},U=t=>new Promise((e,v)=>{const d=new FileReader;d.onload=w=>{var O;e((O=w.target)==null?void 0:O.result)},d.onerror=v,d.readAsText(t,"UTF-8")}),P=async t=>{try{(await U(t)).split(/\r?\n/).filter(d=>d.trim()!=="").forEach((d,w)=>{const O=j();x.value.push({key:""+(C.value+1),wx_id:d.trim(),auth:O})})}catch(e){throw console.error("文件读取失败:",e),new Error("文件读取失败")}return!1};return(t,e)=>{const v=f("a-tag"),d=f("a-button"),w=f("a-upload"),O=f("a-input"),A=f("a-typography-link"),H=f("a-table");return l(),T(H,{columns:a,"data-source":x.value,scroll:{y:120},pagination:!1,"row-key":"wx_id",style:{width:"33vw"},bordered:"",ref_key:"tableRef",ref:m},{title:s(()=>[Fe,S("h2",He,"总数："+D(C.value),1),S("div",We,[Je,n.value.length===0?(l(),_("h3",Qe,"暂无")):R("",!0),(l(!0),_(E,null,se(n.value,$=>(l(),T(v,{key:$,closable:"",onClose:y=>I($)},{default:s(()=>[p(D($),1)]),_:2},1032,["onClose"]))),128))]),S("div",Ge,[r(d,{size:"small",onClick:q,disabled:n.value.length===0},{default:s(()=>[p("增加wx")]),_:1},8,["disabled"]),r(d,{size:"small",onClick:h},{default:s(()=>[p("清空")]),_:1}),r(w,{"before-upload":P,"show-upload-list":!1,accept:".txt",class:"upload-btn"},{default:s(()=>[r(d,{size:"small",disabled:n.value.length===0},{default:s(()=>[p("导入TXT文件")]),_:1},8,["disabled"])]),_:1}),r(O,{value:b.value,"onUpdate:value":e[0]||(e[0]=$=>b.value=$),placeholder:"请输入验证语",allowClear:"",size:"small",style:{width:"200px","margin-left":"10px"}},null,8,["value"]),r(d,{size:"small",onClick:e[1]||(e[1]=$=>M(b.value)),disabled:b.value===""},{default:s(()=>[p("增加验证语")]),_:1},8,["disabled"])])]),bodyCell:s(({column:$,record:y,text:Q})=>[["wx_id","auth"].includes($.dataIndex)?(l(),_("div",Xe,[o[y.key]?(l(),T(O,{key:0,value:o[y.key][$.dataIndex],"onUpdate:value":V=>o[y.key][$.dataIndex]=V,style:{margin:"-5px 0"}},null,8,["value","onUpdate:value"])):(l(),_(E,{key:1},[p(D(Q),1)],64))])):R("",!0),$.dataIndex==="operation"?(l(),_(E,{key:1},[o[y.key]?(l(),_("span",Ye,[r(A,{onClick:V=>g(y.key)},{default:s(()=>[p("保存")]),_:2},1032,["onClick"])])):(l(),_("span",Ze,[r(A,{onClick:V=>u(y.key)},{default:s(()=>[p("编辑")]),_:2},1032,["onClick"])])),r(A,{style:{"margin-left":"10px"},onClick:V=>k(y.key)},{default:s(()=>[p("删除")]),_:2},1032,["onClick"])],64)):R("",!0)]),_:1},8,["data-source"])}}}),et=W(Ke,[["__scopeId","data-v-dc65ccbe"]]),tt={class:"content"},at={key:0,class:"loading"},lt={class:"device-list"},st={class:"pagination-box"},ot=N({__name:"TotalView",setup(c){const i=ye.PRESENTED_IMAGE_SIMPLE,a=z(!1),x=z(!1),n=z([]),b=z([]),m=z([]),I=z(null),j=le(()=>{var t;return((t=I.value)==null?void 0:t.data.length)===0}),h=z({current:1,pageSize:20,total:0,showQuickJumper:!0,showSizeChanger:!0,pageSizeOptions:["20","30","50","80"],showTotal:t=>"共 "+t+" 条"}),C=K(ee,{style:{fontSize:"50px"},spin:!0}),o=t=>{b.value=t},u=async()=>{await k(),x.value=!0},g=async t=>{a.value=!0;const e=await ce(t);if(!e.data.data){B.error(e.data.message),a.value=!1;return}m.value=Object.keys(e.data.data).map(v=>({id:v,...e.data.data[v]})).sort((v,d)=>d.start_time-v.start_time),a.value=!1},k=async()=>{a.value=!0;const t=await G();t.data.data&&typeof t.data.data=="object"?(a.value=!1,m.value=Object.keys(t.data.data).map(e=>({id:e,...t.data.data[e]})).sort((e,v)=>v.start_time-e.start_time)):(a.value=!1,m.value=[]),a.value=!1},q=t=>{h.value.current=t,M()},M=async t=>{try{a.value=!0;let e={page:h.value.current,size:h.value.pageSize,sort:"state",order:"desc"};const v=await re(e);v.data.data&&typeof v.data.data=="object"?(a.value=!1,n.value=v.data.data,h.value.total=v.data.total):(a.value=!1,n.value=[]);const d=await G();d.data.data&&typeof d.data.data=="object"?(a.value=!1,m.value=Object.keys(d.data.data).map(w=>({id:w,...d.data.data[w]})).sort((w,O)=>O.start_time-w.start_time)):(a.value=!1,m.value=[])}catch{a.value=!1}},U=t=>{t.state==1?window.open("/d/"+t.domain+"/","_blank"):t.stat==0?B.error("设备不在线"):B.error("没有设备连接该插槽")},P=async t=>{const e={friends:Array.from(I.value.data)};if(b.value.length===0){B.error("请选择设备");return}a.value=!0;const v=await xe(t,b.value.map(d=>d.domain),e);if(!v.data.data){B.error(v.data.message),a.value=!1;return}m.value=Object.keys(v.data.data).map(d=>({id:d,...v.data.data[d]})).sort((d,w)=>w.start_time-d.start_time),a.value=!1};return te(()=>{M()}),(t,e)=>{const v=f("a-spin"),d=f("a-col"),w=f("a-row"),O=f("a-button"),A=f("a-pagination"),H=f("a-drawer"),$=f("a-empty");return l(),T(de,null,{default:s(()=>[S("div",tt,[a.value?(l(),_("div",at,[r(v,{indicator:F(C),tip:"加载中"},null,8,["indicator"])])):R("",!0),n.value.length>0?(l(),_(E,{key:1},[S("div",lt,[n.value.length?(l(),T(w,{key:0,gutter:[20,20]},{default:s(()=>[(l(!0),_(E,null,se(n.value,y=>(l(),T(d,{key:y.domain,xs:12,sm:8,md:8,lg:6,xl:4,xxl:3},{default:s(()=>[(l(),T(Se,{key:y.domain,deviceItem:y,onClick:Q=>U(y)},null,8,["deviceItem","onClick"]))]),_:2},1024))),128))]),_:1})):R("",!0)]),S("div",st,[r(O,{type:"primary",style:{"margin-right":"50px"},size:"middle",onClick:u},{default:s(()=>[p("操作")]),_:1}),r(A,{"show-size-changer":h.value.showSizeChanger,"show-quick-jumper":h.value.showQuickJumper,current:h.value.current,"onUpdate:current":e[0]||(e[0]=y=>h.value.current=y),total:h.value.total,pageSize:h.value.pageSize,"onUpdate:pageSize":e[1]||(e[1]=y=>h.value.pageSize=y),"show-total":h.value.showTotal,pageSizeOptions:h.value.pageSizeOptions,onChange:q},null,8,["show-size-changer","show-quick-jumper","current","total","pageSize","show-total","pageSizeOptions"])]),r(H,{title:"运行脚本",placement:"bottom",open:x.value,onClose:e[4]||(e[4]=y=>x.value=!1),"body-style":{padding:"0px",margin:"0px",overflow:"hidden",height:"100%",display:"flex",justifyContent:"start",alignItems:"start"}},{extra:s(()=>[r(O,{style:{"margin-right":"8px"},onClick:e[2]||(e[2]=y=>P("addfriends")),disabled:j.value},{default:s(()=>[p("加好友")]),_:1},8,["disabled"]),r(O,{onClick:e[3]||(e[3]=y=>P("toast"))},{default:s(()=>[p("Toast")]),_:1})]),default:s(()=>[r(Le,{"device-list":n.value,onSelect:o},null,8,["device-list"]),r(et,{ref_key:"inputRef",ref:I},null,512),r(Ve,{"task-list":m.value,onDelete:g,onRefresh:k},null,8,["task-list"])]),_:1},8,["open"])],64)):(l(),T($,{key:2,image:F(i)},null,8,["image"]))])]),_:1})}}}),xt=W(ot,[["__scopeId","data-v-085806c3"]]);export{xt as default};
